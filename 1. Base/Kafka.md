+ [Структура]()
+ [Преимущества Kafka]()


## Структура

+ [1. Сообщение и пакеты]()
+ [2. Топики и разделы]()
+ [3. Производители и потребители]()
+ [4. Брокеры и кластеры]()
+ [5. Несколько кластеров]()


### 1. Сообщение и пакеты
Сообщение представляет собой массив байтов
Ключ - В сообщении может быть дополнитеьный фрагмет метаданных. Представляет собой тоже массив байтов
Ключи используются при необходисомти лучше управлять записью сообщений в разделы

Для эффективности сообщения записываются пакетами
Пакет (batch) представляет собой набор сообщений, относящихся к одному топику и разделу

### 2. Топики и разделы
Сообщения распределяются по топикам (topics)
Топики разбиваются на разделы (partitions)

Раздел представляет собой отдельный журнал
Сообщения записываются в него путем добавления в конец, а читаются по порядку от наала к концу

Любой из разделов можно разместить на отдельном сервере, что позволяет

### 3. Производители и потребители
Производители(producers) - генерируют новые сообщения. Производители сообщений создают их для конкретного топика. 
По умолчанию производитель будет равномерно поставлять сообщения во все разделы топика. 
В некоторых случаях он будет направлять сообщение в конкретный раздел. Для этого служат клют сообщения и объект Partitioner
Partitioner - генерирует хеш ключа и у станавливает его соотвестветствие с конкретным разделом. Это гарантирует запись всех сообщений с одиннаковым ключем в один и тот же раздел

Потребители(consumer) - читают сообщения.
Потребитель подписывается на один или более топиков и читает сообщения в корядке их создания в каждом разделе
Он ослеживает уже прочитанные сообщения, запоминая смещение сообщений
Смещение(offset) - непрерывно возрастающее целочисленное значение - элемент метаданных

Потребители работают в составе групп потребителей (consumer group) - одного или нескольких потребителей, объединенных для обработки топика
Организация в группы гарантирует чтение каждого раздела только одним членом группы.
Таким образом появляется возможность горизонтального масштабирования
В случае сбоя отдельного потребителя, оставшиеся члены группы переназначат потребляемые разделы

### 4. Брокеры и кластеры
Блокер(broker) - отдельный сервер Kafka
- Получает сообщения от производителей, присваивает им смещения и записывает в дисковое хранилище.
- Обслуживает потребителей и отвечает на запросы выборки из разделов, возвращая опубликованные сообщения

Блокеры предназначны для работы в составе _кластера_ (cluster)
Один из брокеров кластера функционрирует в качестве _контроллера_(cluster controller)
Контроллер кластера - выбираетсч автоматически из числа работающих членов кластера. 
    Отвечает за административные операции, включая распределение разделов по брокерам и мониторинг отказов брокеров

Каждый раздел принадлежи  одному из брокеров кластера, который называется ведущим (leader).
Реплицированный раздел можно назначить дополнительным брокерам, которые называются _последователями_(fillowers)
Все последователи полжны соединяться с ведущим для публикации сообщений
Потребители могут получать сообщения либо от ведущего, либо от одного из последователей

### 5. Несколько кластеров
Причины для нескольких кластеров:
- Разделение типов данных
- Изоляция по требованиям безопасности
- Несколько центров обработки данных (ЦОД)

Проект Kafka MirrorMaker позволяет реплицировать данные на другие кластера
Сообщения из двух локальных кластеров агрегируются в составной кластер, который затем копируется в другие ЦОД

## END ---------------- Структура ----------------

## Преимущества Kafka

+ [1. Несколько производителей]()
+ [2. Несколько потребителей]()
+ [3. Сохранение информации на диске]()
+ [4. Масштабируемость]()
+ [5. Высокое быстродействие]()

### 1. Несколько производителей
Может работать с несколькими производителями, даже если они используют разные топики
Это позволяет агрегировать данные из множества клиенских систем и обеспечивает их согласованность

### 2. Несколько потребителей
Несколько потребителей могут читать любой одтин поток сообщений, не мешая друг другу

### 3. Сохранение информации на диске
Предполагает долговременное хранение данных и возможность чтение не в реальном времени
Правила хранения можно задать для каждого топика по отдельности

### 4. Масштабируемость
Благодаря горизонтальному масштабированию на каждом этапе структуры можно без проблем масштабировать в ходе развития системы

### 5. Высокое быстродействие
Благодаря схеме "Публикация/Подписка" получается отличная производительность при высокой нагрузке


## END ---------------- Преимущества Kafka ----------------